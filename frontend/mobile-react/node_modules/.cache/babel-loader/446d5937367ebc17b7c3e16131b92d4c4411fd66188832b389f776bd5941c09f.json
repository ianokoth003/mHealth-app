{"ast":null,"code":"import localforage from \"localforage\";\nimport api from \"./axios\";\nlocalforage.config({\n  name: \"healthease\"\n});\nexport const saveLocalRecord = async (type, record) => {\n  const key = `unsynced:${Date.now()}:${Math.random()}`;\n  await localforage.setItem(key, {\n    type,\n    record,\n    local_id: key\n  });\n  return key;\n};\nexport const listUnsynced = async () => {\n  const items = [];\n  await localforage.iterate((value, k) => {\n    if (k.startsWith(\"unsynced:\")) items.push({\n      key: k,\n      ...value\n    });\n  });\n  return items;\n};\nexport const clearLocalKey = key => localforage.removeItem(key);\nexport const uploadSync = async () => {\n  const items = await listUnsynced();\n  if (!items.length) return {\n    uploaded: []\n  };\n  const records = items.map(i => ({\n    type: i.type,\n    data: i.record,\n    local_id: i.key\n  }));\n  const resp = await api.post(\"/sync/upload\", {\n    records\n  });\n  // on success, remove local items matched by local_id\n  const uploaded = resp.data.uploaded || [];\n  for (const u of uploaded) {\n    await clearLocalKey(u.local_id);\n  }\n  return resp.data;\n};","map":{"version":3,"names":["localforage","api","config","name","saveLocalRecord","type","record","key","Date","now","Math","random","setItem","local_id","listUnsynced","items","iterate","value","k","startsWith","push","clearLocalKey","removeItem","uploadSync","length","uploaded","records","map","i","data","resp","post","u"],"sources":["C:/Users/Administrator/Downloads/mhealth/frontend/mobile-react/src/api/syncService.js"],"sourcesContent":["import localforage from \"localforage\";\r\nimport api from \"./axios\";\r\n\r\nlocalforage.config({ name: \"healthease\" });\r\n\r\nexport const saveLocalRecord = async (type, record) => {\r\n  const key = `unsynced:${Date.now()}:${Math.random()}`;\r\n  await localforage.setItem(key, { type, record, local_id: key });\r\n  return key;\r\n};\r\n\r\nexport const listUnsynced = async () => {\r\n  const items = [];\r\n  await localforage.iterate((value, k) => {\r\n    if (k.startsWith(\"unsynced:\")) items.push({ key: k, ...value });\r\n  });\r\n  return items;\r\n};\r\n\r\nexport const clearLocalKey = (key) => localforage.removeItem(key);\r\n\r\nexport const uploadSync = async () => {\r\n  const items = await listUnsynced();\r\n  if (!items.length) return { uploaded: [] };\r\n  const records = items.map(i => ({ type: i.type, data: i.record, local_id: i.key }));\r\n  const resp = await api.post(\"/sync/upload\", { records });\r\n  // on success, remove local items matched by local_id\r\n  const uploaded = resp.data.uploaded || [];\r\n  for (const u of uploaded) {\r\n    await clearLocalKey(u.local_id);\r\n  }\r\n  return resp.data;\r\n};\r\n"],"mappings":"AAAA,OAAOA,WAAW,MAAM,aAAa;AACrC,OAAOC,GAAG,MAAM,SAAS;AAEzBD,WAAW,CAACE,MAAM,CAAC;EAAEC,IAAI,EAAE;AAAa,CAAC,CAAC;AAE1C,OAAO,MAAMC,eAAe,GAAG,MAAAA,CAAOC,IAAI,EAAEC,MAAM,KAAK;EACrD,MAAMC,GAAG,GAAG,YAAYC,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIC,IAAI,CAACC,MAAM,CAAC,CAAC,EAAE;EACrD,MAAMX,WAAW,CAACY,OAAO,CAACL,GAAG,EAAE;IAAEF,IAAI;IAAEC,MAAM;IAAEO,QAAQ,EAAEN;EAAI,CAAC,CAAC;EAC/D,OAAOA,GAAG;AACZ,CAAC;AAED,OAAO,MAAMO,YAAY,GAAG,MAAAA,CAAA,KAAY;EACtC,MAAMC,KAAK,GAAG,EAAE;EAChB,MAAMf,WAAW,CAACgB,OAAO,CAAC,CAACC,KAAK,EAAEC,CAAC,KAAK;IACtC,IAAIA,CAAC,CAACC,UAAU,CAAC,WAAW,CAAC,EAAEJ,KAAK,CAACK,IAAI,CAAC;MAAEb,GAAG,EAAEW,CAAC;MAAE,GAAGD;IAAM,CAAC,CAAC;EACjE,CAAC,CAAC;EACF,OAAOF,KAAK;AACd,CAAC;AAED,OAAO,MAAMM,aAAa,GAAId,GAAG,IAAKP,WAAW,CAACsB,UAAU,CAACf,GAAG,CAAC;AAEjE,OAAO,MAAMgB,UAAU,GAAG,MAAAA,CAAA,KAAY;EACpC,MAAMR,KAAK,GAAG,MAAMD,YAAY,CAAC,CAAC;EAClC,IAAI,CAACC,KAAK,CAACS,MAAM,EAAE,OAAO;IAAEC,QAAQ,EAAE;EAAG,CAAC;EAC1C,MAAMC,OAAO,GAAGX,KAAK,CAACY,GAAG,CAACC,CAAC,KAAK;IAAEvB,IAAI,EAAEuB,CAAC,CAACvB,IAAI;IAAEwB,IAAI,EAAED,CAAC,CAACtB,MAAM;IAAEO,QAAQ,EAAEe,CAAC,CAACrB;EAAI,CAAC,CAAC,CAAC;EACnF,MAAMuB,IAAI,GAAG,MAAM7B,GAAG,CAAC8B,IAAI,CAAC,cAAc,EAAE;IAAEL;EAAQ,CAAC,CAAC;EACxD;EACA,MAAMD,QAAQ,GAAGK,IAAI,CAACD,IAAI,CAACJ,QAAQ,IAAI,EAAE;EACzC,KAAK,MAAMO,CAAC,IAAIP,QAAQ,EAAE;IACxB,MAAMJ,aAAa,CAACW,CAAC,CAACnB,QAAQ,CAAC;EACjC;EACA,OAAOiB,IAAI,CAACD,IAAI;AAClB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}