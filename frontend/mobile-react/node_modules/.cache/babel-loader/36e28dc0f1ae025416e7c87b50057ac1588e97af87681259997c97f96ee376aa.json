{"ast":null,"code":"import _objectSpread from\"C:/Users/Administrator/Downloads/mhealth/frontend/mobile-react/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import localforage from\"localforage\";import api from\"./axios\";localforage.config({name:\"healthease\"});export const saveLocalRecord=async(type,record)=>{const key=\"unsynced:\".concat(Date.now(),\":\").concat(Math.random());await localforage.setItem(key,{type,record,local_id:key});return key;};export const listUnsynced=async()=>{const items=[];await localforage.iterate((value,k)=>{if(k.startsWith(\"unsynced:\"))items.push(_objectSpread({key:k},value));});return items;};export const clearLocalKey=key=>localforage.removeItem(key);export const uploadSync=async()=>{const items=await listUnsynced();if(!items.length)return{uploaded:[]};const records=items.map(i=>({type:i.type,data:i.record,local_id:i.key}));const resp=await api.post(\"/sync/upload\",{records});// on success, remove local items matched by local_id\nconst uploaded=resp.data.uploaded||[];for(const u of uploaded){await clearLocalKey(u.local_id);}return resp.data;};","map":{"version":3,"names":["localforage","api","config","name","saveLocalRecord","type","record","key","concat","Date","now","Math","random","setItem","local_id","listUnsynced","items","iterate","value","k","startsWith","push","_objectSpread","clearLocalKey","removeItem","uploadSync","length","uploaded","records","map","i","data","resp","post","u"],"sources":["C:/Users/Administrator/Downloads/mhealth/frontend/mobile-react/src/api/syncService.js"],"sourcesContent":["import localforage from \"localforage\";\r\nimport api from \"./axios\";\r\n\r\nlocalforage.config({ name: \"healthease\" });\r\n\r\nexport const saveLocalRecord = async (type, record) => {\r\n  const key = `unsynced:${Date.now()}:${Math.random()}`;\r\n  await localforage.setItem(key, { type, record, local_id: key });\r\n  return key;\r\n};\r\n\r\nexport const listUnsynced = async () => {\r\n  const items = [];\r\n  await localforage.iterate((value, k) => {\r\n    if (k.startsWith(\"unsynced:\")) items.push({ key: k, ...value });\r\n  });\r\n  return items;\r\n};\r\n\r\nexport const clearLocalKey = (key) => localforage.removeItem(key);\r\n\r\nexport const uploadSync = async () => {\r\n  const items = await listUnsynced();\r\n  if (!items.length) return { uploaded: [] };\r\n  const records = items.map(i => ({ type: i.type, data: i.record, local_id: i.key }));\r\n  const resp = await api.post(\"/sync/upload\", { records });\r\n  // on success, remove local items matched by local_id\r\n  const uploaded = resp.data.uploaded || [];\r\n  for (const u of uploaded) {\r\n    await clearLocalKey(u.local_id);\r\n  }\r\n  return resp.data;\r\n};\r\n"],"mappings":"mJAAA,MAAO,CAAAA,WAAW,KAAM,aAAa,CACrC,MAAO,CAAAC,GAAG,KAAM,SAAS,CAEzBD,WAAW,CAACE,MAAM,CAAC,CAAEC,IAAI,CAAE,YAAa,CAAC,CAAC,CAE1C,MAAO,MAAM,CAAAC,eAAe,CAAG,KAAAA,CAAOC,IAAI,CAAEC,MAAM,GAAK,CACrD,KAAM,CAAAC,GAAG,aAAAC,MAAA,CAAeC,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAF,MAAA,CAAIG,IAAI,CAACC,MAAM,CAAC,CAAC,CAAE,CACrD,KAAM,CAAAZ,WAAW,CAACa,OAAO,CAACN,GAAG,CAAE,CAAEF,IAAI,CAAEC,MAAM,CAAEQ,QAAQ,CAAEP,GAAI,CAAC,CAAC,CAC/D,MAAO,CAAAA,GAAG,CACZ,CAAC,CAED,MAAO,MAAM,CAAAQ,YAAY,CAAG,KAAAA,CAAA,GAAY,CACtC,KAAM,CAAAC,KAAK,CAAG,EAAE,CAChB,KAAM,CAAAhB,WAAW,CAACiB,OAAO,CAAC,CAACC,KAAK,CAAEC,CAAC,GAAK,CACtC,GAAIA,CAAC,CAACC,UAAU,CAAC,WAAW,CAAC,CAAEJ,KAAK,CAACK,IAAI,CAAAC,aAAA,EAAGf,GAAG,CAAEY,CAAC,EAAKD,KAAK,CAAE,CAAC,CACjE,CAAC,CAAC,CACF,MAAO,CAAAF,KAAK,CACd,CAAC,CAED,MAAO,MAAM,CAAAO,aAAa,CAAIhB,GAAG,EAAKP,WAAW,CAACwB,UAAU,CAACjB,GAAG,CAAC,CAEjE,MAAO,MAAM,CAAAkB,UAAU,CAAG,KAAAA,CAAA,GAAY,CACpC,KAAM,CAAAT,KAAK,CAAG,KAAM,CAAAD,YAAY,CAAC,CAAC,CAClC,GAAI,CAACC,KAAK,CAACU,MAAM,CAAE,MAAO,CAAEC,QAAQ,CAAE,EAAG,CAAC,CAC1C,KAAM,CAAAC,OAAO,CAAGZ,KAAK,CAACa,GAAG,CAACC,CAAC,GAAK,CAAEzB,IAAI,CAAEyB,CAAC,CAACzB,IAAI,CAAE0B,IAAI,CAAED,CAAC,CAACxB,MAAM,CAAEQ,QAAQ,CAAEgB,CAAC,CAACvB,GAAI,CAAC,CAAC,CAAC,CACnF,KAAM,CAAAyB,IAAI,CAAG,KAAM,CAAA/B,GAAG,CAACgC,IAAI,CAAC,cAAc,CAAE,CAAEL,OAAQ,CAAC,CAAC,CACxD;AACA,KAAM,CAAAD,QAAQ,CAAGK,IAAI,CAACD,IAAI,CAACJ,QAAQ,EAAI,EAAE,CACzC,IAAK,KAAM,CAAAO,CAAC,GAAI,CAAAP,QAAQ,CAAE,CACxB,KAAM,CAAAJ,aAAa,CAACW,CAAC,CAACpB,QAAQ,CAAC,CACjC,CACA,MAAO,CAAAkB,IAAI,CAACD,IAAI,CAClB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}